---
import BaseLayout from "./BaseLayout.astro";

const { frontmatter } = Astro.props;

// Date formatting
const formattedDate = new Date(frontmatter.pubDate).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<BaseLayout pageTitle={frontmatter.title}>
  <article class="w-full md:mt-24 mt-12 mx-auto group/article">
    
    {/* --- Header Section --- */}
    <header class="mb-12 text-left">
      {/* Meta Data */}
      <div class="flex items-center gap-2 text-sm font-bold tracking-widest uppercase text-base-content/60 mb-4">
        <time datetime={frontmatter.pubDate}>{formattedDate}</time>
        <span>&bull;</span>
        <span>{frontmatter.author}</span>
      </div>

      {/* Title (with ID for linking) */}
      <h1 
        id="main-title" 
        class="text-4xl md:text-6xl font-extrabold text-base-content tracking-tight leading-tight mb-6 scroll-mt-12 md:scroll-mt-24"
      >
        {frontmatter.title}
      </h1>

      {/* Tags */}
      {frontmatter.tags && (
        <div class="flex flex-wrap gap-2 mb-8">
          {frontmatter.tags.map((tag) => (
            <a href={`/tags/${tag}#tag-title`} class="badge badge-outline badge-lg font-medium text-base-content/70 hover:bg-base-content hover:text-base-100 transition-colors cursor-default">
              #{tag}
            </a>
          ))}
        </div>
      )}

      {/* Hero Image */}
      {frontmatter.image && (
        <figure class="w-full aspect-video overflow-hidden rounded-box shadow-sm mt-8 border border-base-content/10">
          <img
            class="w-full h-full object-cover"
            src={frontmatter.image.url}
            alt={frontmatter.image.alt}
            transition:name={`image-${frontmatter.title}`} 
          />
        </figure>
      )}
      
      {/* Description / Lead */}
      <p class="text-2xl italic text-base-content/80 mt-8 leading-relaxed border-l-4 border-primary pl-6">
        {frontmatter.description}
      </p>
    </header>

    {/* --- Markdown Content --- 
        Changes:
        1. prose-xl (bigger font)
        2. md:prose-2xl (even bigger on desktop)
        3. leading-loose (more space between lines)
        4. prose-p:mb-8 (more space between paragraphs)
    */}
    <div class="prose prose-xl md:prose-2xl prose-headings:scroll-mt-20 max-w-none text-base-content 
                leading-loose
                prose-p:mb-8 prose-li:mb-4
                prose-headings:text-base-content prose-headings:font-bold prose-headings:tracking-tight
                prose-strong:text-base-content 
                prose-code:text-primary prose-code:bg-base-200 prose-code:px-1 prose-code:rounded-sm prose-code:font-normal prose-code:before:content-none prose-code:after:content-none
                prose-blockquote:border-l-primary prose-blockquote:text-base-content/80 prose-blockquote:font-normal
                prose-img:rounded-box prose-img:shadow-md"
         id="article-content">
      <slot />
    </div>
  </article>

  {/* --- Toast Notification --- */}
  <div id="toast-container" class="toast toast-center toast-bottom z-50 pointer-events-none opacity-0 transition-opacity duration-300">
    <div class="alert alert-success shadow-lg text-success-content text-sm font-semibold py-2 px-4">
      <span>Link copied to clipboard!</span>
    </div>
  </div>
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const content = document.getElementById('article-content');
    if (!content) return;

    const headings = content.querySelectorAll('h2, h3');

    headings.forEach((heading) => {
      if (!heading.id) {
        heading.id = heading.textContent
          .toLowerCase()
          .replace(/\s+/g, '-')
          .replace(/[^\w-]/g, '');
      }

      heading.classList.add('group', 'flex', 'items-center', 'gap-4', 'relative'); // gap-4 for more space

      const btn = document.createElement('button');
      btn.className = 'btn btn-ghost btn-sm btn-square opacity-0 group-hover:opacity-100 transition-all duration-200 text-base-content/50 hover:text-primary hover:bg-base-200';
      btn.setAttribute('aria-label', 'Copy link');
      btn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
          <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
        </svg>
      `;

      btn.addEventListener('click', () => {
        const url = `${window.location.origin}${window.location.pathname}#${heading.id}`;
        navigator.clipboard.writeText(url).then(() => {
          const toast = document.getElementById('toast-container');
          if (toast) {
            toast.classList.remove('opacity-0');
            setTimeout(() => {
              toast.classList.add('opacity-0');
            }, 2000);
          }
        });
      });

      heading.appendChild(btn);
    });
  });
</script>